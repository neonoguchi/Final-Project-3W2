import pygame
import random
import time

#window dimensions
screen_width = 800
screen_height = 600
screen_dimensions = (screen_width,screen_height)

velo = 5

class Player():
    def __init__(self, x=600, y=550, width=25, height=25, health=100):
        self.width = width
        self.height = height
        self.rect = pygame.Rect(x, y, width, height)
        self.color = pygame.Color(0, 210, 0)
        self.health = health
        self.dead = False

    def update(self):
        #checks health for death
        if self.health < 0:
            self.dead = True
    
    def update_position(self):
        keys = pygame.key.get_pressed()
        if keys[pygame.K_w] and self.rect.y > 0:
            self.rect.y -= velo
        if keys[pygame.K_a] and self.rect.x > 0:
            self.rect.x -= velo
        if keys[pygame.K_s] and self.rect.y < screen_height - self.height:
            self.rect.y += velo
        if keys[pygame.K_d] and self.rect.x < screen_width - self.width:
            self.rect.x += velo

    def borders(self):
        if self.y <= 0:
            self.y = 0
        elif self.y >= screen_height:
            self.y = screen_height
        
        if self.x <= 0:
            self.x = 0
        elif self.x >= screen_width:
            self.x = screen_width
    
    def draw(self, screen):
        if not self.dead:
            pygame.draw.rect(screen, self.color, self.rect)

class Door():
    def __init__(self, x, y, width, height):
        self.rect = pygame.Rect(x, y, width, height)
        self.color = 'Yellow'
        self.pos = (x, y)
        self.is_open = False
    
    def update(self, player):
        if self.rect.colliderect(player.rect):
            self.color = 'Yellow'
            #[E] interact with door
            if pygame.key.get_pressed()[pygame.K_e]:
                #change to next level
                



                print("Add code to change levesl!")
                self.is_open = True
        else:
            self.color = 'Red'
    
    def draw(self,screen):
        pygame.draw.rect(screen, pygame.Color(self.color), self.rect)


def initialize_level(player, door):
    player.rect.x = 600
    player.rect.y = 550
    door.color = 'Yellow'

def main():
    pygame.init()
    pygame.display.set_caption("Simple RPG")
    screen = pygame.display.set_mode(screen_dimensions)
    clock = pygame.time.Clock()
    player = Player()
    door = Door(200, 0, 60, 10)
    level = 1
    
    initialize_level(player, door)

    #game loop
    running = True
    while running:

        #event handler
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False
        
        #player updates
        player.update_position()

        # door detection
        door.update(player)

        #background fill
        screen.fill((15,30,15))
        #draw
        player.draw(screen)
        door.draw(screen)

        if door.is_open:
            initialize_level(player, door)
            level += 1
            print(f"Door opened! Transitioning to level {level}")
            
            
            # Reset the door for the next level
            topside = Door(random.randrange(0, 800, 60), 0, 60, 10)
            bottomside = Door(random.randrange(0, 800, 60), (600 - 10), 60, 10)
            leftside = Door(0, random.randrange(0, 600, 60), 10, 60)
            rightside = Door((800 - 10), random.randrange(0, 600, 60), 10, 60)
            door =  random.choice([topside, bottomside, leftside, rightside])
        
        pygame.display.update()
        clock.tick(60) #fps


if __name__ == "__main__":
    main()